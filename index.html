<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>CliMapaTron - Overcoming light pollution</title>
<!-- 

Timeless Template 

http://www.templatemo.com/tm-517-timeless

-->
    <!-- load CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/templatemo-style.css">
    <!-- Templatemo style -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="js/msdropdown/jquery-1.3.2.min.js" type="text/javascript"></script>
    <script src="js/msdropdown/jquery.dd.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="css/msdropdown/dd.css" />
    <link rel="stylesheet" type="text/css" href="fontello/fontello.css" />
    
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 800px;
      }
    </style>
    
</head>

<p class="language"><a href="index_es.html">Español</a></p>
<!--
                        <nav class="facet_menu clearfix">

                        <ul id="lang_menu" class="lang_menu">
                            <li id="lang_menu_item1" class="lang_menu_item">Language</li>
                            <li id="lang_menu_item2" class="lang_menu_item"><select class="ddTitle borderRadiusTp ddOutOfVision dd ddcommon borderRadius  " data-width="fit">

                                    <option >English</option>
                                    <option ><a href="index_es.html">Spanish</a></option>
                                </select></li>
                        </ul>
                        
                        <script>
                            var language = "all";
                            $('#selector').on('change', function (e) {

                                var optionSelected = $("option:selected", this);
                                var valueSelected = this.value;
                                console.log(valueSelected);
                                language = this.value;

                            });
                        </script> -->                    



<body>

    <div class="container">


                <header class="text-center tm-site-header">

                        <div class="logo-box">
                        <img class="logo" src="img/logo.png"/>
                        <h1 class="title">Overcoming light pollution</h1>
                        </div>

                </header>



                            


    <!-- MAPA -->
        <div class="row">
            <div class="col-lg-12">

                    <div id="map"></div>

                    
                
            </div>
        </div>
    <!-- FILTROS -->

                        <nav class="item_facet_menu clearfix">
                                                
                        <ul id="item_menu" class="item_menu">
                            <li id="item_menu_item1" class="item_menu_item">Choose item</li>
                            <li id="item_menu_item2" class="item_menu_item"><select class="select_box" data-width="fit">

                                    <option class="ddTitleText ddlabel description" data-content='<span class="flag-icon flag-icon-us"></span> all'>All items</option>
                                    <option  data-content='<span class="flag-icon flag-icon-mx"></span> lights'>Streetlights</option>
                                    <option  data-content='<span class="flag-icon flag-icon-mx"></span> stores'>Stores</option>
                                    <option  data-content='<span class="flag-icon flag-icon-mx"></span> estops'>Bus stops</option>
                                </select></li>
                        </ul>
                        <script>
                            var language = "all";
                            $('#selector').on('change', function (e) {

                                var optionSelected = $("option:selected", this);
                                var valueSelected = this.value;
                                console.log(valueSelected);
                                language = this.value;

                            });
                        </script>                    
                    </nav>
        <div class="container tm-container-2">
            
                <div class="col-lg-12">
                    <h3 class="subtitle">The problem - Light pollution</h3>
                </div>
            
            <div class="row tm-section-mb">
                <div class="col-lg-12">
                    <div class=" tm-timeline-item">
                        <div class="tm-timeline-item-inner">
                            <img src="img/img-01.jpg" alt="Image" class="rounded-circle tm-img-timeline">
                            <div class="tm-timeline-connector">
                                <p class="mb-0">&nbsp;</p>
                            </div>
                            <div class="tm-timeline-description-wrap">
                                <div class="tm-bg-dark tm-timeline-description">
                                    <h3 class="tm-text-green tm-font-400">Light pollution - a threat to global health</h3>
                                    <p>Eye strain, loss of clear vision, aging of the eyes and stress are just some consequences of light pollution on our health. Moreover, the implications for wildlife, ecosistem disruptions and waste production are serious consequences that must be prevented.</p>
                                    
                                </div>
                            </div>
                        </div>

                        <div class="tm-timeline-connector-vertical"></div>
                    </div>

                    <div class="tm-timeline-item">
                        <div class="tm-timeline-item-inner">
                            <img src="img/img-02.jpg" alt="Image" class="rounded-circle tm-img-timeline">
                            <div class="tm-timeline-connector">
                                <p class="mb-0">&nbsp;</p>
                            </div>
                            <div class="tm-timeline-description-wrap">
                                <div class="tm-bg-dark-light tm-timeline-description">
                                    <h3 class="tm-text-cyan tm-font-400">Over illumination in big cities</h3>
                                    <p>The "over illumination" phenomenon is given specially in big cities, where  presence of lighting intensity higher than that which is appropriate for a specific activity.</p>
                                </div>
                            </div>
                        </div>
                        <div class="tm-timeline-connector-vertical"></div>
                    </div>






                </div>
            </div>
            <!--  row -->
            <hr>
            <h3 class="subtitle">The solution - Citizen Science</h3>
            <div class="row tm-section-mb tm-section-mt">
                <div class="card_tw col-lg-4 col-md-4 col-sm-12 pr-lg-5 mb-md-0 mb-4">
                    <h3 class="card_title">1. Take a picture</h3>
                    <p>Take a picture whenever you see an illuminated store during its closing hours (i.e. Apple store lights on at 3.00 am).</p>
                </div> 
                <div class="card_tw col-lg-4 col-md-4 col-sm-12 pr-lg-5 mb-md-0 mb-4">
                    <h3 class="card_title ">2. Post it on Twitter</h3>
                    <p>Post the picture, the address and the name of the store on Twitter.</p>
                </div>
                <div class="card_tw col-lg-4 col-md-4 col-sm-12">
                    <h3 class="card_title ">3. Tag @climapatron and #lightsoff</h3>
                    <p>Tag @climapatron and the use #lightsoff and your contribution will appear on this map, showing the places in Madrid with over illumination.</p>
                </div>
            </div>
            <hr>

        <div class="team">
                <h3 class="mb-4 team">The team</h3>

                <img class="img" src="img/team_test.jpg" alt="climapatrontest" >
            <ul class="team_list">
                <li class="team_list_item">Andrea Cimmino - Researcher and almost PhD @ OEG</li>
                <li class="team_list_item">David Chaves - Researcher and PhD student @ OEG</li>
                <li class="team_list_item">Patricia Martín - PhD student @ OEG</li>
                <li class="team_list_item">Idafen Santana - PostDoc and hero @ OEG</li>
            </ul>
            
            <p class="icon-twitter"><a target="blank" href="https://twitter.com/climapatron">@climapatron</a></p>

        </div>
        <hr>
        <!-- Footer -->
        <footer class="row mt-5 mb-5">
            <div class="col-lg-12">
                <p class="text-center tm-text-gray tm-copyright-text mb-0">Copyright &copy;
                    <span class="tm-current-year">2018</span> CliMapaTron 
                </p>
            </div>
        </footer>
    </div>
    <!-- .container -->

    <script src="js/jquery.min.js"></script>
    <!-- <script src="js/jquery-3.2.1.slim.min.js"></script> -->
    <script src="js/templatemo-script.js"></script>
    <script>
      
    var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open("get", url, true);
      xhr.responseType = "json";
      xhr.onload = function() {
        var status = xhr.status;
        if (status == 200 || status == 202) {
          callback(null, xhr.response);
        } else {
          callback(status);
        }
      };
    xhr.send();
    };


// This example creates circles on the map, representing populations in North
// America.



var map = undefined;
var markers = [];
var markersInfo = [];
var observationInfo = [];

var lamppost_icon = './lamp-post.png';
var no_connection_icon = 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';


//setTimeout(updateStatus, 10000);

function initMap(lat, lng, zoom) {
  if (map != undefined) {
        return map;
  }
  
  return new google.maps.Map(document.getElementById('map'), {
        zoom: zoom,
        center: {lat: lat, lng: lng},
        mapTypeId: google.maps.MapTypeId.TERRAIN
  });
}

/*
function initStatus(){
  updateStatus();
  setInterval(updateStatus, 20000);
}
*/

function mapCallback() {
    map = initMap(40.4292958,-3.6889029, 18);
    
    console.log("Paso");
    
    var markers=[];
    
    getJSON("http://climathon1.stars4all.eu/sparql?query=select+distinct+*+%7B%0D%0A+++%3Fs+<http%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23type>+%3Ftype+.%0D%0A+++%3Fs+<http%3A%2F%2Fwww.w3.org%2F2003%2F01%2Fgeo%2Fwgs84_pos%23lat>+%3Flat+.%0D%0A+++%3Fs+<http%3A%2F%2Fwww.w3.org%2F2003%2F01%2Fgeo%2Fwgs84_pos%23long>+%3Flong+.%0D%0A+++OPTIONAL+%7B%0D%0A+++%09%09%3Fs2+a+<http%3A%2F%2Fschema.org%2FTweet>+.%0D%0A+++%09%09%3Fs2+<http%3A%2F%2Fwww.schema.org%2Flight-overkill>+%3Fs+.%0D%0A+++%7D%0D%0A%7D%0D%0A",
    function(err, data) {
      if (err != null) {
        alert("Something went wrong: " + err);
      } else {
        
        console.log("Size:"+data.bindings.length);
        
        
        for (var count in data.bindings){
          
          json_object = data.bindings[count];
          
          //console.log(json_object);
          
          
          var type = json_object.type.value;
          var lat = json_object.lat.value;
          var long = json_object.long.value;
          
          var icon = null;
          
          if (type.includes("Lamppost") || type.includes("LocalBusiness")) {
            
            if (type.includes("Lamppost")) {
              icon = './icons/lamp-post.png';
            } else if (type.includes("LocalBusiness")) {
              if (json_object.s2) {
                icon = './icons/store_red.png';
              } else {
                icon = './icons/store.png';
              }
            } 
            
            var position = {lat:Number(lat),lng:Number(long)};
           
            var marker = new google.maps.Marker({
              position: position,
              map: map,
              icon: icon
            });
            
             markers.push(marker);
            
          } else {
            console.log("Other:"+type);
          }
          
        
        }
        
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
        
      }
    });
}

    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoyg3qxPOvfAqXwUfdP0hY_4faF5qOt9Y&signed_in=true&callback=mapCallback"></script>
    <script>
       var mymap = L.map('mapid').setView([51.505, -0.09], 13);
       L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'your.mapbox.access.token'
        }).addTo(mymap);

    </script>

</body>
</html>